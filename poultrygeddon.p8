pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _init()
	p=plr_new(60,60)
end

function _update60()
	plr_update(p)
end

function _draw()
	cls()
	
	plr_draw(p)
end
-->8
-- player --

function plr_new(x,y)
	local plr={
		x=x or 0,
		y=y or 0,
		spr=48,
		flip_x=false,
		running=false
	}
	
	plr.running_ani=
		plr_mk_running_ani(plr)
	
	return plr
end

function plr_update(plr)
	local running=
		btn(⬅️) or
		btn(➡️) or
		btn(⬆️) or
		btn(⬇️)
	
	if running then
		ani_update(plr.running_ani)
		
		local mv_speed=1
		local x_mv=btn(⬅️) or btn(➡️)
		local y_mv=btn(⬆️) or btn(⬇️)
		local xy_mv=x_mv and y_mv
		
		if xy_mv then
			mv_speed=mv_speed*.70
		end

		if btn(⬅️) then
			plr.x-=mv_speed
			plr.flip_x=true
		elseif btn(➡️) then
			plr.x+=mv_speed
			plr.flip_x=false
		end
		
		if btn(⬆️) then
			plr.y-=mv_speed
		elseif btn(⬇️) then
			plr.y+=mv_speed
		end
	else
		plr.spr=48 -- idle frame
	end
end

function plr_draw(plr)
	spr(plr.spr,plr.x,plr.y,1,1,plr.flip_x)
end

function plr_mk_running_ani(plr)
	local ani=ani_new(12,true)
	
	ani_add(ani,function()
		plr.spr=49
	end)
	ani_add(ani,function()
		plr.spr=50
	end)
	ani_add(ani,function()
		plr.spr=51
	end)
	ani_add(ani,function()
		plr.spr=50
	end)
	
	ani_start(ani)
	
	return ani
end
-->8
-- utils --

function ani_new(fps,loop)
	return {
		frame=1,
		frames={},
		fps=fps or 60,
		loop=loop or false,
		started=false,
		ended=false,
		dlt=0
	}
end

function ani_start(ani)
	ani.started=true
end

function ani_add(ani,fn,dur)
	dur=dur or 1
	for i=1,dur do
		add(ani.frames,fn)
	end
end

function ani_update(ani)
	if not ani.started or
				ani.ended then
		return
	end
	
	ani.dlt+=1
	if ani.dlt>60 then
		ani.dlt=1
	end
	
	local t=60/ani.fps
	if ani.dlt%t==0 then
		ani.frame+=1
		local fn=ani.frames[ani.frame]
		
		if fn then
			fn()
		elseif ani.loop then
			ani.frame=1
			local fn=ani.frames[1]
			fn()
		else
			ani.frame-=1
			ani.ended=true
		end
	end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00904000009040000090400000904000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009c9910009c9910009c9910009c9910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0099aaa00099aaa00099aaa00099aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00ccc00000ccc00000ccc00000ccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9ccc7c0090ca70009ccc70009ccc70a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9accca0090ccc00090acca009acccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09777000097779000977700009777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00909000009000000900090000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
